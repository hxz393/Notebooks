# 安装配置

## 前置条件

由于Docker运行于Linux内核中,因此对于系统要求如下:

- 系统必须位为64位操作系统;
- 系统内核版本需要大于3.10;
- 硬盘要足够大.

可以使用以下命令查询系统位数和内核版本:

```sh
[root@server3 ~]# uname -r
3.10.0-1160.42.2.el7.x86_64
```



## 安装Docker

在之前安装过Docker的主机上,需要完全卸载后再安装.

全新安装需要先修改仓库配置,增加docker-ce安装源:

```sh
[root@server4 ~]# yum install -y yum-utils
[root@server4 ~]# yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
Loaded plugins: fastestmirror
adding repo from: https://download.docker.com/linux/centos/docker-ce.repo
grabbing file https://download.docker.com/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo
repo saved to /etc/yum.repos.d/docker-ce.repo
```

假如要安装nightly或test版本,使用下面的命令来启用对应仓库.关闭使用--disable参数:

```sh
[root@server4 ~]# yum-config-manager --enable docker-ce-nightly
[root@server4 ~]# yum-config-manager --enable docker-ce-test
```

安装最新版docker-ce:

```sh
[root@server4 ~]# yum install docker-ce docker-ce-cli containerd.io
```

要安装特定版本,可以使用yum list来查询:

```sh
[root@server4 ~]# yum list docker-ce --showduplicates | sort -r
docker-ce.x86_64            3:20.10.9-3.el7                    docker-ce-stable 
docker-ce.x86_64            3:20.10.9-3.el7                    @docker-ce-stable
docker-ce.x86_64            3:20.10.8-3.el7                    docker-ce-stable 
```

例如安装20.10.8版本:

```sh
[root@server4 ~]# yum install docker-ce-20.10.8 docker-ce-cli-20.10.8 containerd.io
```



## 更新Docker

在docker仓库源启用的情况下,使用yum upgrade来更新:

```sh
[root@server4 ~]# yum upgrade
```



## 卸载Docker

使用下面的命令完全卸载Docker旧版本及相关程序:

```sh
[root@server4 ~]# yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine
```

删除新版Docker引擎:

```sh
[user10@server4 ~]$ yum remove docker-ce docker-ce-cli containerd.io
```

删除Docker使用的库,镜像和容器等数据:

```sh
[root@server4 ~]# rm -rf /var/lib/docker
[root@server4 ~]# rm -rf /var/lib/containerd
```



## 启动Docker

启动服务与设置开机启动:

```sh
[root@server4 ~]# systemctl start docker
[root@server4 ~]# systemctl enable docker
Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.

```



## 测试Docker

使用hello-world镜像来测试Docker功能是否正常:

```sh
[root@server4 ~]# docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
```



## 配置Docker

Docker安装时会新建一个docker组,可以将普通用户加入此组,这样普通用户就能直接运行docker命令:

```sh
[root@server4 ~]# useradd -p user10 user10
[root@server4 ~]# su -l user10
[user10@server4 ~]$ docker image ls
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.24/images/json": dial unix /var/run/docker.sock: connect: permission denied
[user10@server4 ~]$ su -c 'usermod -G docker user10'
[user10@server4 ~]$ docker image ls
REPOSITORY    TAG       IMAGE ID       CREATED       SIZE
hello-world   latest    feb5d9fea6a5   3 weeks ago   13.3kB
```





