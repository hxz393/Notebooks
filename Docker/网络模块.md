# 网络模块

## Docker网络

Docker通过Network Namespace为每个容器建立了独立网络,形成完全与宿主机隔离的环境.

默认情况下,Docker会在宿主机上架设一个名为docker0的虚拟网络,用来连接宿主机与容器.容器与docker0之间通过Veth Pair来连接,所有连接到docker0上的容器同属于一个子网中,而宿主机也通过虚拟网卡连接到了docker0上.



## 端口映射

容器与宿主机通过docker0网桥沟通,而容器与外网访问可以通过docker0转发到宿主机外网网卡上,但是外部网络无法访问容器.为解决这一问题,可以使用端口映射方式,将容器的端口与宿主机端口绑定,外部网络便能通过此端口访问容器.

端口映射可以在建立镜像时使用-P参数,将容器需要暴露的端口,随意映射到主机空闲端口上.也可以使用-p参数来固定要映射到的宿主机端口.



## 容器连接

有时一个容器中运行的应用程序,需要与运行在另外一个容器中的应用程序通过网络交换数据,这时就需要通过容器连接来完成.

要设置容器间通信,可以在创建容器时使用--link参数指定要连接的容器,这样会打开对被连接容器的网络访问.

例如创建一个MySQL容器,并让一个Web服务容器连接到它:

```sh
[root@server4 ~]# docker run -d --name mysql mysql
[root@server4 ~]# docker run -d -p 80:80 -p 443:443 --name web --link mysql:db nginx
```

连接容器并不需要指明或映射被连接容器mysql的端口,被连接容器端口只在容器间的通信中使用,不会被暴露在外网中,也不会被其他容器访问到.建立连接唯一需要确保的条件是连接和被连接的容器都要处于运行状态.

另外为了避免连接容器名与连接容器内某些配置重名,Docker支持容器间使用别名进行连接.例如上面就使用db来作为容器mysql的别名.在web容器中可以使用db作为访问时的主机名.

