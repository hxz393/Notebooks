# 基础概念

## Docker运行基础

Docker主要使用的技术有LXC和AUFS.

### LXC

Linux内核有一套机制来管理CPU,内存,网络等资源,这套核心被称为CGroups和Namespaces.

CGroups可以限制,记录,调整进程组所使用的物理资源.例如给某进程多分配一些CPU资源或限制使用的内存上限.Linux有了CGroups资源管理机制,内核虚拟化才成为可能.

Namespaces是资源隔离机制.它将进程,进程组,IPC,网络,内存等资源变得不再是全局性资源,将资源从内核层面分属于某个特定Namespace,不同Namespace之间资源互相透明不可见.

LXC就是基于Linux内核通过调用CGroups和Namespaces来实现容器轻量级虚拟化的技术.同时,LXC也是一组面向Linux内核容器的用户态API接口.用户通过LXC提供的功能可以创建一套完整且互相隔离的虚拟应用运行环境.也是Docker运行的基础.

### AUFS

UnionFS是一个堆栈式的联合文件系统,AUFS原名Another UnionFS,是对UnionFS的补充.随着AUFS发展后更名为高级多层次统一文件系统(Advanced Multi Layered Unification Filesystem).简单来说就是可以将分布在不同地方的目录挂载到同一个虚拟文件系统中.

Docker参考Linux启动过程,将一个readonly权限的bootfs(虚拟文件系统)挂载到容器文件系统中,然后通过AUFS将readonly权限的rootfs(根目录文件系统)添加到bootfs之上.之后每次挂载一个readonly的FS文件层,将用户所要使用的文件内容挂载到rootfs之上.

这些文件层就是堆栈式文件系统中所保存的数据,整个文件系统称为联合文件系统.而AUFS就是用来管理,使用这些文件层的文件系统.

Docker利用AUFS加载完最高层之后,会在最上面再添加一个rw权限的FS层.容器内部的应用,对当前文件系统所有写操作都会保存在这个FS层当中,当使用commit命令后,Docker会将这个FS层中的数据作为单独一个文件层保存在AUFS之中.

镜像(Image)可以理解为特定FS层的集合.从镜像启动容器(Container)时,Docker会依次加载BaseImage和其上image.通过镜像分隔为AUFS的文件层,使得所有容器可以共享文件层,且不会发生写冲突.



## Docker应用范围

Docker由dotCloud于2013年正式开源,2015年开始大规模应用.

### 云平台

现在Docker主要应用于云平台.在Docker出现以前各云平台互不兼容,Docker屏蔽了硬件层的差异,提供了统一的用户应用层,企业产品因此可以在各种云平台之前自由迁移.

### Devops

Docker另外一个应用领域是Devops,只要使用相同的数据镜像,就不用考虑环境问题,减少了代码运行差异,使得开发团队可以集中于产品开发,无需注重流程.



## Docker优缺点

总的来看Docker的缺点暂不构成问题,可以放心使用.

### 优点

使用Docker的优点有:

- **高资源利用率**

  传统虚拟机硬件资源独立不共享,Docker中所有容器共享同一个系统内核和硬件资源,对资源的利用率比虚拟机高得多.

- **支持跨节点部署**

  通过Docker定义的标准镜像数据格式,可以在不同操作系统和物理硬件环境中使用.

- **版本可控,组件可复用**

  Docker借助AUFS文件系统的特性,使得镜像与镜像之间可以互相借用组合,产生不同的镜像.并借助标签功能对镜像标注,为镜像提供版本控制功能.

- **共享镜像**

  Docker作为开源软件,构建出的镜像可以自由分发流传(主要通过Docker hub).

- **轻量级,易维护**

  Docker在Linux系统中表现为一个普通的进程,因此管理非常容易.

### 缺点

Docker的缺点有:

- **宿主资源没有完全做到隔离**

  虽然容器使用的系统资源互相隔离,但还有一些内核资源未被隔离开来.例如/proc, /sys这些目录和SELinux, syslog这些内核功能.造成Docker的稳定性存疑.

- **GO语言尚不成熟**

  由于Docker全部采用Golang来编写,而Golang还比较年轻,难保不发生大的变动.这将对Docker产生连带影响.

- **控制权问题**

  虽然Docker现在开源,但事实上被一家公司所控制,而不像其他大的开源项目有公共基金会管理.因此后续可能变为收费闭源项目.

