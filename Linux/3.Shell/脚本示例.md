# 脚本示例

## 输出消息

在echo命令使用-n参数可以让输出不换行:

```sh
#!/bin/bash
fruite=orange
count=110
echo -n "We have ${count} ${fruite}s"
echo "??"
```



## 交互式脚本

即使用read来读取用户保存到变量中:

```sh
#!/bin/bash
read -r -p "Set Username: " newuser
read -r -p "Set Password: " newpass
echo -e "\n Your user:pass is: $newuser:$newpass"
```



## 命令替换

备份时将备份时间自动写入到文件名中:

```sh
#!/bin/bash
# 利用date获取时间,格式为190322
data1=$(date +%Y%m%d)
filename1='sqlbackup'
# 使用变量命名文件名
touch "$filename1-$data1"
```



## 数值运算

可以使用`$[计算式]`来进行整数运算:

```sh
#!/bin/bash
a=10
b=$[$a+4]
c=$[a*b]
echo $c
```

可以使用`$((计算式))`来进行整数加减乘除运算:

```sh
#!/bin/bash
read -rp "first number:" nu1
read -rp "second number:" nu2
total=$((nu1*nu2))
echo -e "\nThe result of $nu1 * $nu2 is $total"
```

另一种不太常用的方式是使用命令expr,因为有些符号在shell中另有含义(比如*),这时需要用\来转义:

```sh
[root@server1 ~]# expr 5 \* \( 3 + 1 \)
20
```

如果想计算小数,可以调用bc来处理.:

```sh
#!/bin/bash
a=11;b=3
c=$(echo "scale=4; $a/$b"|bc)
echo $c
```



## 文件检测

例如根据用户输入检测文件是否存在,不存在返回'not exist',存在返回文件类型:

```sh
#!/bin/bash
read -rp "Type filename:" file1
test -z $file1 && echo "Type error" && exit 0
test -e $file1 || echo "not exist" && exit 0
test -f $file1 && echo "$file1 is file" 
test -d $file1 && echo "$file1 is dir"
```



## 使用中括号判断

使用[]判断用户输入yes还是no:

```sh
#!/bin/bash
read -rp "Type yes or no: " utype
[ "$utype" == "yes" ] && echo 'OK' && exit 0
[ "$utype" == "no" ] && echo 'NO'  && exit 0
echo 'ERROR' && exit 0
```

判断用户是否为root:

```bash
#!/bin/bash
if [ $UID -ne 0 ]; then
echo Non root user.
else
echo root user.
fi
```



## 参数变量调用

写一段脚本将特殊变量输出:

```sh
#!/bin/bash
echo "Script name is: $0"
echo "Parameter number is: $#"
echo "Whole parameter: $@"
echo "Frist parameter: $1"
```

运行结果:

```sh
[root@101c7 bin]# bash sh06.sh op1 ca2
Script name is: sh06.sh
Parameter number is: 2
Whole parameter: op1 ca2
Frist parameter: op1
```



## If条件判断

使用if判断对输入参数进行检测:

```bash
#!/bin/bash
if [ "$1" == "Hello" ] || [ "$1" == "hello" ]; then
    echo "hello"
elif [ "$1" == "" ]; then
    echo "no parameters"
else
    echo "only hello allowed"
fi
```



## Case条件判断

使用case判断脚本参数:

```sh
#!/bin/bash
case $1 in
    "hello")
        echo "hello"
        ;;
    "")
        echo "no parameters"
        ;;
    *)
        echo "only hello allowed"
        exit 1
        ;;
esac
```



## 函数调用

简单的函数内参数调用:

```sh
#!/bin/bash
function printype(){
    echo "$1 is best"
}

if [ -n "$2" ]; then
    printype $2
elif [ -n "$1" ]; then
    printype $1
else
    echo "no parameters"
fi
```



## 不定循环

使用while结构,当输入y或Y时才停止脚本:

```sh
#!/bin/bash
while [ "$yn" != "y" ] && [ "$yn" != "Y" ]
do
    read -p "Type y or Y to stop:" yn
done
echo "you stop it!"
```

使用until结构的循环写法:

```sh
#!/bin/bash
until [ "$yn" == "y" ] || [ "$yn" == "Y" ]
do
    read -p "Type y or Y to stop:" yn
done
echo "you stop it!"
```



## 固定循环

使用for来遍历passwd中的用户名,并执行id命令:

 ```sh
 #!/bin/bash
 users=$(cut -d ':' -f1 /etc/passwd)
 for username in $users
 do
     id $username
 done
 ```

使用数字定义循环次数,例如计算101到200之间奇数乘积:

```sh
#!/bin/bash
s=1
for ((i=101;i<=200;i=i+2))
do
    s=$(($s*$i))
done
echo "$s"
```

