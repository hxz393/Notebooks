# 硬件基础

## 计算机简介

拥有输入和输出设备,通过输入设备接受用户输入,经中央处理器的数学与逻辑单元处理后,生成或储存成有用信息的机器就是计算机.

### 计算机组成

计算机由五大部分组成,分别是: 输入单元, 输出单元, CPU内部的控制单元, 算术逻辑单元, 内存.

### 计算机分类

按用途可以分为以下几类:

- **超级计算机**(Supercomputer)

  最快也最贵,用于需要高速计算的项目中,例如军事, 气象, 太空, 模拟等.

- **大型计算机**(Mainframe Computer):

  用于处理大数据和复杂运算,一般见于证券, 银行, 大型企业数据库服务器等.

- **迷你计算机**(Minicomputer)

  低配版的大型计算机,对于场所环境要求没那么严格,一般用在科研, 工程分析, 工厂等地.

- **工作站**(Workstation)

  针对特殊用途设计的计算机,比如图形工作站, 机器学习等,比起PC来说强调稳定性.

- **微电脑**(Microcomputer)

  又叫个人计算机(PC).也分移动和桌面型电脑等.
  
  

## CPU

中央处理器(CPU,Central Processing Unit)是一个具有特定功能的芯片,里头含有微指令集.是计算机最重要的组成部分.

### **CPU组成单元**

- **算术逻辑单元**

  负责运算与逻辑运算.

- **控制单元**

  协调各周边元间与各单元间的工作.

### **CPU指令集**

按照指令集设计理念分为精简指令集和复杂指令集:

- **精简指令集**(RISC,Reduced Instruction Set Computing)

  微指令集较为精简,每个指令的执行时间都很短,完成的动作单一,执行性能好.

  常见的RISC CPU有Sun公司的SPARC系列(用于学术,银行大型工作站),IBM公司的Power Architecture(包括	PowerPC,例如索尼PS游戏机),ARM系列(手机,网络设备)

- **复杂指令集**(CISC,Complex Instruction Set Computer)

  每个小指令可以执行一些较低阶的硬件操作,指令数目多而复杂,每条指令的长度不同.执行时间较长,但每个指	令可以处理的工作较为丰富.

  常见的CISC CPU有AMD和Intel的x86,x64构架处理器.叫x86因为由最早Intel的元组型号8086发展而来,构架	从8位升级到32位,现在普遍使用的是64位CPU,统称为x86_64构架.

### **微指令集**

不同x86构架的CPU区别除了二级缓存大小等硬件参数差异外,微指令也略有所不同.比如Intel处理器就有用于虚拟化(Intel-VT),视频硬解码(MMX,SSE)等独特指令集,可以有效提升针对特定工作的运行效率.

### 多核心

所谓多核心是在一颗CPU封装中嵌入两个以上的运算核心.

### CPU频率

CPU频率就是CPU每秒可以进行的工作次数,频率越高表示这颗CPU单位时间内可以做更多事情.

例如CPU的频率为4.0GHz代表这颗CPU在一秒内可以进行4*10^9^次工作.

### 南北桥

由于Intel和AMD的CPU构架并不兼容,所以主板芯片设计也不同.Intel早期芯片组分北桥和南桥.

- **北桥**

  负责连接速度较快的CPU,内存和显卡等元件.也叫系统总线.

- **南桥**

  负责连接速度较慢的设备接口,包括硬盘,USB,网卡等.也叫输入输出总线.

目前主流构架中,大多将北桥内存控制器整合到CPU封装当中了,这样CPU和设备之间直接通信(QPI,DMI技术),速度更快且不用消耗更多带宽.北桥也不会成为制约CPU频率的瓶颈.

### 32位和64位

与总线宽度相似,CPU每次能处理的数据量称为字组大小(word size),一次数据读取的最大量为32位或64位.

通常说的32位主要是依据CPU解析的字组大小(4个字节)而来.64位代表CPU一次可以读写64bits(8个字节)数据.

因为CPU读取数据量有限,能够从内存中内存中读写的数据也有限制.32位CPU含有32根地址线,寻址能力为232个字节,相当于4GB,所以只能支持到4GB内存大小.

### 外频与倍频

早期CPU构架主要通过北桥来链接CPU,内存与显卡设备,所有设备都要通过北桥来链接,因此每个设备的工作频率要求相同,于是就有了前端总线(FSB, Front Side Bus)这个东西.但因为CPU的运算速度远远超过其他设备,又为了满足FSB的频率,因此就有了所谓的外频和倍频.

- **外频**

  指CPU与外部元间进行数据数据传输时的速度.

- **倍频**

  是CPU内部用来加速工作性能的一个倍数.

CPU频率=外频*倍频

### 超线程

超线程(HT, Hyper-Threading)是在每一个CPU内部将重要的寄存器(register)分为两群,让程序分别使用这两群寄存器.也就是说可以有两个程序同时竞争CPU的运算单元,而非通过操作系统的多任务切换.

通过HT机制,操作系统可以使用实际核心的两倍数量,并且让每个核心逻辑上分离.

在支持多核心运行的程序时,只要运算达不到100%的CPU使用率,超线程确实能帮助提升执行速度,更好地利用CPU性能.

### **多级缓存**

一般CPU拥有二级(L2 Cache)或更多级缓存,由比DRAM速度更快的静态随机访问内存(SRAM, Static Random Access Memory)组成.用于存放一些很常用数据,这样数据不通过内存读取,极高提升了性能.



## 内存

CPU处理的数据来源于内存,而处理完毕的数据也要先写回内存,再从内存传输到输出单元.

内存主要组件为动态随机访问内存(DRAM, Dynamic Random Access Memory),只有通电时才能记录与使用,断电数据消失,因此也叫挥发性内存.

### 内存类型

内存由**SDRAM**发展为**DDR**(Double Data Rate)也就是所谓的双倍数据传送速度SDRAM,它可以在一次工作周期中进行两次数据传送.

例如DDR400的内存,代表数据宽度64bit,外频200MHz,频率400MHz,频宽3.2GB/s

### 内存速度

内存工作频率由CPU内的内存控制器决定,假如内存频率为1600MHz,总线宽度64bit,理论最大传输速度为:

$1600MHz*64bit=1600MHz*8Bytes=12800MB/s=12.8GB/s$

### 多通道设计

当两条同样的内存插入支持内存双通道的主板中时,总线宽度由64bit升级到128bit,传输速度翻倍.这是双通道内存的设计理念.

除了双通道外,服务器提供三信道甚至四信道的内存环境.



## 主板

主板(main board)有用来沟通所有设备的芯片组,将它们链接起来,提供给CPU使用.

现代主板一般集成了相当多的设备元件,比如:声卡, 网卡, 显卡, 磁盘整列卡等.

### CMOS芯片

记录主板重要参数,比如系统时间,CPU频率,设备I/O位址与IRQ等,需要额外电子供电来保存设置.

### BIOS

BIOS(Basic Input Output System)直译基础输入输出系统,是使用闪存(Flash Memory)或EEPROM保存开机时执行的程序,程序主要用来加载和修改CMOS当中的参数,并尝试调用储存设备中的开机程序.

一般在开机时按[del]按键或[F1]按键进入BIOS.

### UEFI

UEFI(Unified Extensible Firmware Interface)为新一代BIOS,可以使用一个特制的shell来做些管理工作.

### 固件

固件(firmware)是绑定在硬件例如磁盘阵列卡,网卡等上面的控制软件.通常储存在ROM只读储存器(Read Only Memory)中,保证固件安全.

### PCI插槽

主板上的扩展插槽主要有PCI和PCI-E,速度对比表如下:

| 规格      | 宽度(bit) | 速度(MHz) | 频宽 |
| ------------- | --------- | --------- | -------- |
| PCI           | 32        | 33        | 133MB/s  |
| PCI 2.2       | 64        | 66        | 533MB/s  |
| PCI-X         | 64        | 133       | 1064MB/s |
| AGP 4x        | 32 bit | 66x4  | 1066MB/s |
| AGP 8x        | 32 bit    | 66x8  | 2133MB/s |
| PCI-E x1      |           |           | 250MB/s  |
| PCI-E x8      |           |           | 2GB/s    |
| PCI-E 2.0  x8 |           |           | 4GB/s    |
| PCI-E 3.0  x8 |           |           | 8GB/s    |
| PCI-E 4.0  x8 |           |           | 16GB/s   |

一般表示PCI-E不同规格由插槽长短决定,主板上的PCI-E插槽运行模式可以参考主板的说明书.如果将x16速度的设备插在x8速度的PCI-E插槽上,设备会以x8的速度运行.

以CPU常见支持的16个信道(PCI-E 3.0 x16)举例,如果主板上有三个PCI-E插槽,那么依据插上设备数量而定,PCI-E插槽的速度可以工作在以下模式: 1 x16 , 2 x8 , 1 x8 + 2 x4.

### **USB接口**

USB接口一般用来接U盘,移动硬盘盒,键盘鼠标等设备,各版本带宽与速度对比如下:

| 版本    | 带宽      | 速度(MByte/s) |
| ------- | --------- | ------------- |
| USB 1.0 | 12Mbit/s  | 1.5           |
| USB 2.0 | 480Mbit/s | 60            |
| USB 3.0 | 5Gbit/s   | 500           |
| USB 3.1 | 10Gbit/s  | 1000          |

主板为了快速区别版本,给USB接口采用不同颜色显示:白色代表USB 2.0,蓝色代表USB 3.0,红色代表USB 3.1.

### 其他接口

常见的接口有下面这些.

- **音频输入与输出**

  一些3.5mm圆形插孔,一般用绿色表示耳机插孔,红色表示麦克风插孔.

- **RJ-45网络接口**

  方形接口,用来插网线.

- **HDMI接口**

  如果有板载显卡,会提供视频输出接口.

### 设备I/O位址与IRQ中断信道

主板芯片组通过I/O和IRQ来控制设备.

- **I/O位址**

  I/O位址用来标记对应的设备,如果两个设备使用相同I/O位址会造成地址冲突,设备无法工作.

- **IRQ中断信道**

  IRQ用来标记设备工作状态,以方便CPU分配工作任务.



## 显卡

显卡又称为VGA(Video Graphics Array).负担着图像影像显示的功能.

### 显存

因为每个图像显示的颜色会占用内存,因此显卡上有一个内存的容量,简称显存.

### GPU

此外显卡上还有一个3D加速芯片,专门进行3D运算,简称GPU.

### 显卡插槽

由于显卡需要传输大量数据,因此使用能提供大量带宽的PCI-E插槽.

### 显卡接口

常见显卡上用来连接显示器的接口如下:

- **D-Sub(VGA)**

  为较早之前的连接接口,主要为15针的连接,为模拟讯号传输.

- **DVI**

  比较常见的有提供数字传输的DVI-D与整合数字和模拟传输的DVI-I.

- **HDMI**

  可以同时传输图像和声音.

- **DP(Display port)**

  与HDMI相似. 
  
  

## 硬盘

硬盘是数据储存的设备,一般又分为机械硬盘和固态硬盘.

### 机械硬盘组成

传统机械硬盘(HDD, Hard Disk Driver)物理结构如下:

- **盘片**

  数据记录介质,可以有一个以上盘片.

- **主轴马达**

  带动盘片旋转.转速越高读写速度越快.常见的转速有7200 rpm(转/分钟)和5400 rpm

- **磁头**

  读取盘片中数据,和盘片数量相等.

- **机械手臂**

  控制磁头运动.

此外硬盘电路板上还有一个小容量的闪存用作缓冲内存,用来临时提高硬盘性能.

机械硬盘很脆弱,因此在通电状态下绝对不要发生碰撞或直接拔插头.否则可能造成逻辑坏道(文件系统损坏)或物理坏道.

### 机械硬盘盘片

机械硬盘盘片表面构成如下:

- **扇区(sector)**

  盘片同心圆上切出的一个小区块,磁盘最小物理储存单位.

  普通硬盘设计一个扇区容量为512Byte,大容量硬盘也见使用4KByte扇区设计.

- **磁道(track)**

  在同一个同心圆的扇区组成的圆就是磁道

- **柱面(cylinder)**

  在所有盘片上面统一磁道可以组合成柱面

由于同心圆外圈扇区比内圈扇区多,因此数据读写由外圈向内写.

传统机械硬盘容量计算公式为:$磁头数*柱面*扇区数*512Bytes$​​

### 硬盘传输接口

硬盘与主板连接接口经过多次改版,目前主流的有SATA和SAS接口.

- **IDE接口**

  使用的排线可以接两个设备,因此有主/从(Master/Slave)构架,可以通过跳针设置.

  接口传输速度为Ultra 133规格,理论速度最高133MB/s.

- **SATA接口**

  在家用机上IDE接口的替代接口.SATA的排线将数据传输和供电分开.一条排线对应一个设备,没有跳针设计.

  目前主流的使用的SATA 3.0版本传输速度为600MB/s.

- **SCSI接口**

  在以前服务器硬盘常用接口,硬盘在控制器上含有一块处理器,用来支持一些高级功能.

- **SAS接口**

  SAS(Serial Attached SCSI)是串行式SCSI的意思,目前已在服务器领域全面取代了SCSI.

  SAS 3.0的传输速度能达到1200MB/s.



### 固态硬盘

固态硬盘(SSD, Solid State Disk)以NAND闪存作为储存介质,因此不存在磁头盘片等结构,也没有数据分散的问题,读写速度和延迟时间比机械硬盘优秀.

固态硬盘寿命和速度取决于使用的内存颗粒类型,常见的类型由好到差有:SLC, MLC, TLC, QLC.

一般电脑将SSD作为系统盘,数据储存在HDD上,可以有效提升整个系统性能.



## 电源

电源供应器(Power)用来给主板,CPU,显卡和硬盘供电.选择一个用料好的电源可以有效降低硬件意外损坏概率.

使用AIDA之类的软件对未超频的整机进行烤机测试时,如果出现中途断电重启的情况,说明电源额定功率不够或不稳定.需要减少设备接入或更换更高功率电源.

在选购时除了看电源额定功率外,还要看能源转换率,也就是$输入功率/输出功率$​的值,转换率值越大越好.

