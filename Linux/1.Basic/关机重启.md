# 关机重启

## 查看用户在线状态

如果有别的用户在线,强制关机可能会造成用户文件丢失,可以先使用who当前已登录的用户信息:

```shell
[user1@101c7 root]$ who -Hu
NAME     LINE         TIME             IDLE          PID COMMENT
root     tty1         2021-09-11 09:35  old          897
root     pts/0        2021-09-15 12:12   .          5334 (192.168.2.101)
root     pts/1        2021-09-14 08:40  old        55207 (192.168.2.101)
```



## 数据写回

默认情况下,某些依据加载内存中的数据将不会直接被写回硬盘,而是暂存在内存,可以手动同步将数据写入.

立即运行同步操作:

```shell
[user1@101c7 root]$ sync
```

使用重启关机命令前也会自动调用sync命令.

当非管理员使用sync命令时,只会更新操作用户的数据.



## 关机操作

通常使用shutdown命令来进行关机操作.

~~关机命令必须加入时间参数,否则会自动跳到run-level 1(单用户维护)的登录情况~~

立马关机:

```shell
[user1@101c7 root]$ shutdown -h now
```

预定在21:00关机.如果当前时间超过21:00则会在隔天21:00才关机:

```shell
[user1@101c7 root]$ shutdown -h 21:00
```

预定2分钟后关机,并发送消息:

```shell
[root@101c7 ~]# shutdown -P 120 "will  poweroff"
Shutdown scheduled for Wed 2021-09-15 16:01:48 EDT, use 'shutdown -c' to cancel.
```

取消即将进行的关机操作:

```shell
[root@101c7 ~]# shutdown -c
[root@101c7 ~]# 
Broadcast message from root@101c7 (Wed 2021-09-15 14:01:54 EDT):

The system shutdown has been cancelled at Wed 2021-09-15 14:02:54 EDT!
```



## 重启操作

重启命令可用reboot或halt,选择其一即可.

立马强制关机:

```shell
[root@101c7 ~]# halt -P -f
```

同步后重启系统:

```shell
[root@101c7 ~]# sync; sync; sync; reboot
```



## 切换执行等级

可以通过init命令来切换运行等级,例如进入救援模式:

```shell
[root@localhost ~]# init 1
Broadcast message from root@localhost.localdomain on pts/1 (Fri 2019-07-05 15:40:59 CST):

The system is going down to rescue mode NOW!
```

