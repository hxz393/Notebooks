# 文件权限

## 基本权限

基础权限有三种,分别是: 读(r, read), 写(w, write), 执行(x, eXecute)

同样的权限标记对于文件和目录代表不同意义.



## 文件权限

文件包括一般文本文件,数据库,二进制可执行文件.文件权限只针对文件内容而言,和改名删除等没关.

| 数字 | 字符 | 权限                                                         |
| ---- | ---- | ------------------------------------------------------------ |
| 4    | r    | **读取文件内容**.例如用cat查看,用vim以**只读**方式打开.      |
| 2    | w    | **编辑修改**文件内容,但**不包含删除**文件.例如用vim,sed等对文件内容修改并保存. |
| 1    | x    | 文件具有可以被系统**执行**的权限.例如命令和脚本必须拥有此权限才能直接执行. |



## 目录权限

目录主要的内容是记录文件名清单,所以目录权限实际关联的是目录下文件属性查看与更改.

| 数字 | 字符 | 权限                                                         |
| ---- | ---- | ------------------------------------------------------------ |
| 4    | r    | **仅查询**目录下的文件或目录**名称**,无法看到属性.相当于执行不加参数的ls命令 |
| 2    | w    | 改变目录结构清单权限,也就是在目录下**新建,删除,重命名**文件或目录 |
| 1    | x    | **进入目录**的权限,**查询**目录下的文件**属性**              |



## 权限参考

**用户进入目录所需权限**:

- 目录需要x权限,来运行cd切换目录
- 目录需要r权限,来使用ls命令查看目录中文件列表

**用户读取目录内文件所需权限**:

- 目录需要x权限来进入目录
- 文件需要r权限来运行cat,more等读取文件命令

**用户修改目录内文件所需权限**:

- 目录需要x权限来进入目录
- 文件需要r和w权限来使用vi等工具进行文件读写

**用户创建一个文件所需权限**:

- 目录需要w和x权限来创建文件

**用户执行目录下的命令所需权限**:

- 目录需要x权限来进入目录
- 文件需要x权限来运行命令



## 特殊权限

### SUID

当s标志出现在文件所有者的x权限上时,被称为Set UID,其含义:

- SUID权限仅对二进制程序有效,不能用在脚本上;
- 执行者对该程序需要具有x的可执行权限;
- 本权限仅在执行该程序的过程中(run-time)有效;
- **执行者将具有该程序所有者的权限**.

例如一般用户运行passwd命令修改密码,对应修改了/etc/shadow文件.此文件权限只有root可读写,而用户运行passwd程序时,会暂时获得passwd程序的root权限,/etc/shadown文件也就被一般用户执行的passwd所修改了.

这是因为运行passwd后会取得一个新的进程与PID,该PID产生时通过SUID来给予该PID特殊的权限设置.

### SGID

当s标志在文件所有组x权限上时,被称为Set GID.SGID可以针对文件或目录来设置.

**针对文件**SGID有下面功能:

- SGID对二进制程序有效;
- 程序执行者对改程序来说,需具备x的权限;
- **执行者在执行的过程中将会获得该程序用户组的支持**.

例如一般用户用locate这个程序可以去查询/var/lib/mlocate/mlocate.db文件的内容,会暂时获得slocate用户组的权限.

**针对目录**SGID有下面功能:

- 用户若对此目录具有r和x的权限时,该用户能够进入此目录;
- 用户在此目录下的有效用户组将会变成该目录的用户组;
- 若用户在此目录下具有w的权限,则用户所创建的新文件的属组与此目录的属组相同.

### Sticky Bit

代表SBIT的t出现在文件所有者的其他用户x权限上,目前只针对目录有效.含义是:

- 当用户对此目录具有w和x权限,既具有写入的权限时;
- **当用户在该目录下创建文件或目录时,仅有自己与root才有权力删除该文件.**

例如用户1对目录A具有w的权限,里面还有别的用户文件,此时目录A加上了SBIT权限时,用户1只能修改自己创建的文件,无法删除他人文件.