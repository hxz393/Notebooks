# 调度器

调度器的角色比较简单,就是利用API服务器的监听机制等待新创建的pod,然后给新建pod分配节点.

调度器不会命令选中的节点去运行pod,而是通过API服务器更新pod的定义,然后由API服务器去通知节点上的Kubelet该pod已被调度到此,由目标节点上Kubelet创建并运行pod的容器.

K8s还支持用户自定义调度器.

## 默认的调度算法

调度器的默认调度算法选择节点操作可以分为两部分:首先过滤所有节点,找出能分配给pod的可用节点列表.然后对可用节点按优先级排序,找出最优节点.如果多个节点优先级相同,则循环分配,确保平均分配给pod.



## 查找可用节点

为了找出可用节点,调度器会对每个节点下发一组配置好的预测函数,检查节点信息:

- 节点是否能满足pod对硬件资源的请求;
- 节点是否耗尽资源;
- pod是否有节点选择器;
- 节点是否符合pod中的节点选择器;
- pod请求绑定的主机端口是否已被占用;
- pod请求的储存卷是否能加载,是否可用;
- pod是否能够容忍节点的污点;
- pod是否定义了节点,pod的亲缘性及非亲缘性规则.

所有测试通过,节点才有资格调度给pod.



## 高级调度

默认情况下,归属于同一服务和RS的pod会分散在尽可能多个节点,不过可以通过定义pod的亲缘性或非亲缘性规则,强制pod分散在集群内或集中在一起.



## 多个调度器

可以在集群运行多个调度器,然后在pod特性中设置schedulerName属性指定调度器来调度它.未设置此属性的pod由默认调度器(default-scheduler)调度.

